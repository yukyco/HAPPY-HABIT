###############################################################################################
##
#  PHP画像ギャラリー　ver1.0.1 (2014.02.10)
#
#  画像ギャラリーのプログラムです。
#　任意のページに埋め込みギャラリーページとして運用できます。
#　ページング（ページ送り）、サムネイル生成、リンク時画像拡大機能などがあります。
#　また、PCの他にスマホ、携帯用のファイル同梱していますので（sp/がスマホ、i/が携帯（ガラケー）です。）、
#　3デバイス（PC、スマホ、携帯（ガラケー））の同時更新が可能で、更新効率アップにもっとも最適なプログラムです。
#  改造や改変は自己責任で行ってください。
#	
#  不具合等がありましたら下記までご連絡ください。
#  MailAddress: info@php-factory.net
#  name: K.Numata
#  HP: http://www.php-factory.net/
#
##
###############################################################################################

■主な機能

・フリー（無料）で、もちろん商用も使用OKです。どんなサイトでも設置OKです。

・管理画面から投稿、編集できるので完全自動化（CMS）として運用可能です。

・スマホ（スマートフォン）、携帯用に最適化したファイルも同梱しています（サンプル参照）。
　設定ファイルにて細かい設定が可能で実務での様々な運用に対応します。

・クライアントが投稿することを想定しているので、数MBの大きいままの画像、
　日本語ファイル名の画像ファイルでもあなたが設定したサイズに自動縮小＆半角英数字にリネームします。
　サムネイルも自動生成。（容量が軽いのでスマホ、携帯に最適）※各種設定は設定ファイルにて

・画像のキャプション（タイトル、簡単な説明など）も指定可能。
　※各デバイス（PC、スマホ、携帯）の表示はサンプル参照ください。

・PCの場合、サムネイルはlightboxにて拡大表示＆キャプションを表示。スマホ、携帯もそれぞれ見やすいよう最適化済み。
　もちろんすべてhtml、CSS等を編集してオリジナルデザインも可能です。

・ページング（ページ送り）を自動生成します。画像がいくら増えても順応します。
　※ページングの各種設定も設定ファイルにて可能（1ページあたりの表示数、ナビゲーション数等）

・日付の表示方法も設定可能。2013/7/15（デフォルト）、2013-7-15、2013年7月15日など。

ver1.0.1新機能
・管理画面で画像の並び替えが可能
・管理画面にページャーを実装
・インラインフレーム表示に対応(インラインフレーム使用時にはlightboxではなく通常のポップアップで対応)


■動作環境
PHPバージョン4.3.9（5.5まで動作確認済）
PHP GDライブラリ ※画像の自動縮小に使います。これが無いと動きません。がほとんどのサーバーでは入っているはずです。
入ってない場合は諦めてください・・・。

推奨ブラウザ：IE（8以上）、Firefox、GoogleChrome（Mac環境では動作テストしておりません）
※IE6〜IE7でもテスターでは問題ないことを確認しています。

■ 設置方法　
ファイルの文字コードは基本的にUTF-8です。必ず対応したエディタで開いてください。
メモ帳（UTF-8非対応）は使用禁止です。ファイルが壊れます。TeraPad（無料）やDreamWeaver等で開いてください。
DWだとコードに色付けされ分かりやすいのでおすすめです。
※ PHPでは、スラッシュ2回「//」の後からその行の末尾までがコメント扱いとなります。コード内に複数あります。「#」もです。

◆1.ファイル構成を確認し、表示側の設定を行う

以下ファイル構成になっています。

・umekomi.php
　任意のページにソースコードをコピペするためのファイルです。ファイル内のコメントを参考にコピペしてください。
　既存のサイトがすべて○○.htmlであっても問題ありません。
　このプログラムを使う時点でサーバーがPHPに対応していることになるので、
　いずれかの既存htmlファイルをコピペし、たとえば「gallery.php」の名前で保存すればOKです。
　サイト上でhtmlファイルとPHPファイルが混在していても全然問題ありません。それでgallery.phpに必要なものをコピペすればOKです。
　※もちろんgallery.phpへのリンク時は拡張子が.phpになるので注意下さい。


・Readme.txt ・・・ 設置法、利用規約など。
・lightbox/ ・・・ 画像拡大用のJavascriptで、デフォルトでは必須。※lightboxを使用する場合必須です。

・gallery/　プログラムのメインとなるディレクトリ（フォルダ）です。ディレクトリ名は変更可（変更した場合、埋め込みした部分にあるパス名部分も要変更 ）
　　　　　　ディレクトリ名を変更することで1サイト内に複数のギャラリーを設置可能です。
　　　　　　フォルダ内のファイルはすべて必要です。削除したり移動したりしないでください。

└ index.php ・・・ 既存のトップページ（index.html）に表示させたい場合やその他事情があり既存のhtmlで表示させたい場合には
　　　　　　　　　　このファイルをインラインフレームで読み込んで下さい。インラインフレームを使わない場合はこのファイルは不要です。
└ admin.php ・・・ 管理ページです。 投稿や編集、削除などを行えます。
└ complete.php ・・ 2重登録防止用のファイルです。そのまま置いておきましょう。
└ config.php ・・・ 設定ファイル。管理画面ログイン情報の設定やその他設定
└ function.php ・・ 関数記述など
└ style.css ・・・ admin.php、index.phpのスタイルを記述してます(もちろん独自のCSSでもOKです)

　└ data/news.dat ・・・ 登録データを格納するファイル（パーミッション666等書き込み可能なものに）
　└ data/_.htaccess・・・登録データファイルに直接アクセスされるのを防ぐためのhtaccessファイルです。
　　　　　　　　　　　　　デフォルトでは無効化されてますので、使用する場合はファイル名の先頭の「_」（アンダーバー）を削除して「.htaccess」として下さい
　　　　　　　　　　　　　セキュリティ、個人情報等に関わる情報は記載されていませんので、見られて困ることはあまりないと思います。
　　　　　　　　　　　　　まぁ見られてもいいじゃんて方はそのままでもOKです。
　└ upimg/ ・・・ 画像データの保存先です。（パーミッションを書き込み可能なものに）
　└ js/ ・・・画像拡大用のlightboxや管理画面用のjavascriptなど。※そっとしておきましょう・・。


・i/i_umekomi.php・・・携帯（ガラケー）用のファイルです。携帯用に最適化しています。
上記umekomi.php と同じく既存のhtmlファイル（またはphpファイル）をコピペしてgallery.php等にして、
このファイルから必要箇所をコピペして下さい。コメントにて指示があります。
もちろんレイアウト、デザイン等はhtml等を編集してオリジナルでもOKです。
携帯版を利用しない場合このファイル（ディレクトリごと）は不要です。

携帯（ガラケー）サイトでXML宣言がある場合の注意点
各ファイル最上部にXML宣言を記述している場合、PHPファイルに直接XML宣言を記述するとPHPタグと誤解釈され、結果何も表示されなくなるという致命的な不具合があります。
i_umekomi.phpのように
<?php echo"<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n";?>
と書くことで回避出来ます。（文字コードはお使いのファイルに合わせてください）
※PC、スマホでも同様のことが言えますが、PC、スマホの場合今のところXML宣言を書くこと自体ほぼ意味が無い上にデメリットもあるので書かないことをおすすめします。


・sp/sp_umekomi.php・・・スマホ（スマートフォン）用のファイルです。スマホ用に最適化しています。
上記umekomi.php と同じく既存のhtmlファイル（またはphpファイル）をコピペしてgallery.php等にして、このファイルから必要箇所をコピペして下さい。
コメントにて指示があります。
・sp/detail.php・・・詳細ページ。スマホ版は一覧ページと詳細ページに分けています。
同じくこのファイルから必要箇所をコピペしてください。もちろんこのファイルをそのまま使ってもOKです。
もちろんレイアウト、デザイン等はhtml、CSSを編集してオリジナルでもOKです。
スマホ版を利用しない場合これらのファイル（ディレクトリごと）は不要です。


◆2. ユーザID、パスワードを設定する

config.phpをエディタソフトで開き、ログインのためのID、パスワードを変更してください。
初期値は
ID：admin
パスワード：1397
になっています。必ず変更してください。その他必要に応じてコメントを参考に設定してください。


◆3. FTPでアップ

埋め込んだファイル（たとえばgallery.php）、lightboxフォルダ、galleryフォルダ、携帯、スマホ版も使用する場合にはそのファイルをアップし、
「upimg」ディレクトリのパーミッションを書き込み可能な755 or 777等に設定し、data/news.datのパーミッションを書き込み可能な666等にしてください。
これで完了です。
各パーミッションの適切な値はサーバーのマニュアル等を参考に変更下さい。
サーバーによっては値が違う、または変更の必要自体無いこともあります。
もしパーミッションの設定が間違っていた場合ですが、すべての環境での保証はありませんが管理画面にてその旨警告が表示されるよう設定しています。
またもしパーミッションが間違いの場合には「upimg」ディレクトリの場合、news.datの場合ともに新規投稿時にエラーで登録自体ができません。
要するにまともに動かないのでテスト段階ですぐに気付けます。
逆にそのようなことがない場合は適切なパーミッションになっていると考えてOKです。

ちなみにエックスサーバーの場合、今のところパーミッション変更は不要です。


◆4.ブラウザで確認

ブラウザで「あなたのサイトのURL」/gallery/admin.phpを表示し、管理画面にログイン後投稿を行ってみてください。正常に登録、編集できればOKです。
埋め込んだgallery.php等もブラウザで確認してみて下さい。
投稿データが反映されていればOKです。


◆5. ページの調整

設置するページやその他必要に応じてスタイルシート、HTML等で見た目の調整を行ってください。じゆ〜です！


		
■ 更新履歴
-----------------------------------------------------------------------------------------------------------------------

2014.02.10　v1.0.1　配布開始　並び順変更、管理画面へのページャー実装、ソースコードの大幅な変更等（インラインフレーム表示に対応）
2013.07.15　v1.0.0　Beta版配布開始


■ご利用規約

・無料版プログラムはフリーウェアです。ただし、著作権は放棄するものではありません。
　また、カスタマイズ依頼、著作権表示リンク削除依頼にて表示を削除したとしても著作権は放棄しません。
・プログラムによって何らかの不利益、損害が生じても一切の責任を負いません。
　あらかじめご了承の上ご使用ください。
　もし何らかのトラブルがあった場合には、ご相談いただければ解決策が見つかるかもしれません。
　（クライアントへの原因の説明など）
・プログラムは全ての環境（サーバー）での動作を保証するものではありません。
・プログラムの著作権表示リンクを削除することはできません。（削除依頼をいただいた場合を除く）
・改変等は自己責任でお願いします。
・有料版をご購入いただいた場合、初期不良を除き、使用後の返金には応じ兼ねます。
・プログラムの再配布は禁止しております。

　ダウンロードいただいた時点で利用規約に同意したものとみなされます。


■著作権表示削除について

ページ下部著作権表示リンクの削除には1サイトあたり2,000円の使用料金が必要になります。
2サイト目以降は都度料金が必要になります。
お支払いは銀行振込、またはPayPal（クレジットカード）となります。

ご希望の際は以下URL内「著作権表示削除について」よりお申込みをお願いいたします。
http://www.php-factory.net/gallery/01.php

振込先をお送りいたしますので、そちらにご入金後こちらから必要なファイルを送付させていただきます。
※正常に動作することをご確認後、申請を行なってください。初期不良以外入金後の返金は致しかねますのでご了承ください。

問題等が発生した場合は相談してみてください。解決策が見つかるかもしれません。
基本的にはデータが保存された「news.dat」さえあればなんとでもなります。

■カスタマイズ、設置代行について

PC、携帯、スマホサイトへの設置代行（各3,000円程度）、カスタマイズ（2,000円〜）にも対応いたしますのでご相談ください。
実装が難しいもの、まったく違うものに作り変えるなどは対応出来かねる場合もございます。

+++--------------------------------------------------------+
PHP工房 各種お問い合わせは「お問い合わせ」よりお願いします。
http://www.php-factory.net/
+--------------------------------------------------------+++

